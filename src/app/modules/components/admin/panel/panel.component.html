<div class="admin-main-content-panel">

  <div class="panel-header">
    <h1>Paneli i Administratorit</h1>
    <button class="button-primary" (click)="refreshData()" [disabled]="isLoadingStats || isLoadingActivities">
      <i class="fas fa-sync-alt" [class.spinning]="isLoadingStats || isLoadingActivities"></i>
      Rifresko
    </button>
  </div>

  <section id="dashboard-section" class="dashboard-grid">
    <div class="card">
      <div class="card-icon"><i class="fas fa-book-reader"></i></div>
      <div class="card-title">LearnHubs AktivÃ«</div>
      <div class="card-value">
        <span *ngIf="isLoadingStats" class="loading-spinner">â³</span>
        <span *ngIf="!isLoadingStats">{{ stats.activeLearnHubs | number }}</span>
      </div>
      <div class="card-description">Gjithsej LearnHubs tÃ« publikuar</div>
    </div>
    <div class="card">
      <div class="card-icon"><i class="fas fa-user-graduate"></i></div>
      <div class="card-title">PÃ«rdorues tÃ« Regjistruar</div>
      <div class="card-value">
        <span *ngIf="isLoadingStats" class="loading-spinner">â³</span>
        <span *ngIf="!isLoadingStats">{{ stats.totalRegisteredUsers | number }}</span>
      </div>
      <div class="card-description">Gjithsej pÃ«rdorues nÃ« platformÃ«</div>
    </div>
    <div class="card">
      <div class="card-icon"><i class="fas fa-check-circle"></i></div>
      <div class="card-title">Kuize tÃ« PÃ«rfunduara</div>
      <div class="card-value">
        <span *ngIf="isLoadingStats" class="loading-spinner">â³</span>
        <span *ngIf="!isLoadingStats">{{ stats.completedQuizzes | number }}</span>
      </div>
      <div class="card-description">Kuize tÃ« kaluara me sukses nga pÃ«rdoruesit</div>
    </div>
    <div class="card">
      <div class="card-icon"><i class="fas fa-users-cog"></i></div>
      <div class="card-title">AdministratorÃ« AktivÃ«</div>
      <div class="card-value">
        <span *ngIf="isLoadingStats" class="loading-spinner">â³</span>
        <span *ngIf="!isLoadingStats">{{ stats.activeAdministrators | number }}</span>
      </div>
      <div class="card-description">AnÃ«tarÃ« tÃ« ekipit me qasje administratori</div>
    </div>
  </section>

  <section id="recent-activity-section" class="section-block">
    <h2>Aktivitetet e Fundit</h2>
    
    <!-- Loading state -->
    <div *ngIf="isLoadingActivities" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar aktivitetet...</p>
    </div>
    
    <!-- Empty state -->
    <div *ngIf="!isLoadingActivities && recentActivities.length === 0" class="empty-state">
      <i class="fas fa-inbox"></i>
      <p>Nuk ka aktivitete tÃ« fundit</p>
    </div>
    
    <!-- Activities list -->
    <div *ngIf="!isLoadingActivities && recentActivities.length > 0">
      <div *ngFor="let activity of recentActivities" class="activity-item">
        <span class="icon">
          <i [class]="getActivityIcon(activity.type)"></i>
        </span>
        <span class="text">
          <strong *ngIf="activity.userName">{{ activity.userName }}</strong>
          {{ activity.description }}
        </span>
        <span class="timestamp">{{ formatTimestamp(activity.timestamp) }}</span>
      </div>
    </div>
  </section>

  <!-- Sezione TÃ« Ardhurat Mujore -->
  <section id="revenue-section" class="section-block">
    <h2>TÃ« Ardhurat Mujore</h2>
    
    <div *ngIf="isLoadingRevenue" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar tÃ« dhÃ«nat e tÃ« ardhurave...</p>
    </div>
    
    <div *ngIf="!isLoadingRevenue && monthlyRevenue.length === 0" class="empty-state">
      <i class="fas fa-chart-line"></i>
      <p>Nuk ka tÃ« dhÃ«na tÃ« ardhurash</p>
    </div>
    
    <div *ngIf="!isLoadingRevenue && monthlyRevenue.length > 0" class="revenue-grid">
      <div *ngFor="let revenue of monthlyRevenue" class="revenue-card">
        <div class="revenue-month">{{ getMonthName(revenue.month) }} {{ revenue.year }}</div>
        <div class="revenue-amount">{{ formatCurrency(revenue.revenue) }}</div>
        <div class="revenue-details">
          <span class="new-subscriptions">+{{ revenue.newSubscriptions || 0 }} abonime tÃ« reja</span>
          <span class="cancellations">-{{ revenue.cancellations || 0 }} anulime</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Sezione ShpÃ«rndarja Gjeografike -->
  <section id="geographic-section" class="section-block">
    <h2>ShpÃ«rndarja Gjeografike</h2>
    
    <div *ngIf="isLoadingGeographic" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar tÃ« dhÃ«nat gjeografike...</p>
    </div>
    
    <div *ngIf="!isLoadingGeographic && geographicStats.length === 0" class="empty-state">
      <i class="fas fa-map-marker-alt"></i>
      <p>Nuk ka tÃ« dhÃ«na gjeografike</p>
    </div>
    
    <div *ngIf="!isLoadingGeographic && geographicStats.length > 0" class="geographic-grid">
      <div *ngFor="let geo of geographicStats" class="geographic-card">
        <div class="city-name">{{ geo.city || 'Qyteti i panjohur' }}</div>
        <div class="geo-stats">
          <div class="stat-item">
            <i class="fas fa-users"></i>
            <span>{{ geo.userCount || 0 }} pÃ«rdorues</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-school"></i>
            <span>{{ geo.schoolCount || 0 }} shkolla</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-euro-sign"></i>
            <span>{{ formatCurrency(geo.revenue) }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sezione LearnHubs MÃ« tÃ« SuksesshÃ«m -->
  <section id="top-learnhubs-section" class="section-block">
    <h2>LearnHubs MÃ« tÃ« SuksesshÃ«m</h2>
    
    <div *ngIf="isLoadingTopLearnHubs" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar LearnHubs mÃ« tÃ« suksesshÃ«m...</p>
    </div>
    
    <div *ngIf="!isLoadingTopLearnHubs && topPerformingLearnHubs.length === 0" class="empty-state">
      <i class="fas fa-trophy"></i>
      <p>Nuk ka LearnHubs mÃ« tÃ« suksesshÃ«m</p>
    </div>
    
    <div *ngIf="!isLoadingTopLearnHubs && topPerformingLearnHubs.length > 0" class="performance-list">
      <div *ngFor="let learnhub of topPerformingLearnHubs; let i = index" class="performance-item">
        <div class="rank">#{{ i + 1 }}</div>
        <div class="content">
          <div class="title">{{ learnhub.title || 'Titull i panjohur' }}</div>
          <div class="stats">
            <span class="stat">
              <i class="fas fa-users"></i>
              {{ learnhub.totalStudents || 0 }} studentÃ«
            </span>
            <span class="stat">
              <i class="fas fa-chart-line"></i>
              {{ formatPercentage(learnhub.completionRate) }} pÃ«rfundim
            </span>
            <span class="stat">
              <i class="fas fa-star"></i>
              {{ Math.round((learnhub.averageScore || 0) * 100) }}% mesatare
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sezione Kuize MÃ« tÃ« VÃ«shtirÃ« -->
  <section id="challenging-quizzes-section" class="section-block">
    <h2>Kuize MÃ« tÃ« VÃ«shtirÃ«</h2>
    
    <div *ngIf="isLoadingChallengingQuizzes" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar kuize mÃ« tÃ« vÃ«shtirÃ«...</p>
    </div>
    
    <div *ngIf="!isLoadingChallengingQuizzes && challengingQuizzes.length === 0" class="empty-state">
      <i class="fas fa-question-circle"></i>
      <p>Nuk ka kuize tÃ« vÃ«shtirÃ«</p>
    </div>
    
    <div *ngIf="!isLoadingChallengingQuizzes && challengingQuizzes.length > 0" class="quiz-list">
      <div *ngFor="let quiz of challengingQuizzes" class="quiz-item">
        <div class="quiz-header">
          <div class="quiz-title">{{ quiz.question || 'Pyetje e panjohur' }}</div>
          <div class="difficulty-badge" [style.background-color]="getDifficultyColor(quiz.difficulty)">
            {{ getDifficultyText(quiz.difficulty) }}
          </div>
        </div>
        <div class="quiz-details">
          <span class="detail">
            <i class="fas fa-chart-bar"></i>
            {{ formatPercentage(quiz.successRate) }} sukses
          </span>
          <span class="detail">
            <i class="fas fa-play"></i>
            {{ quiz.totalAttempts || 0 }} tentime
          </span>
          <span class="detail">
            <i class="fas fa-clock"></i>
            {{ Math.round(quiz.averageTimeSpent || 0) }}s mesatare
          </span>
        </div>
        <div class="learnhub-context" *ngIf="quiz.learnHubTitle">
          <i class="fas fa-book"></i>
          {{ quiz.learnHubTitle }}
        </div>
      </div>
    </div>
  </section>

  <!-- Sezione ShÃ«ndeti i Sistemit -->
  <section id="system-health-section" class="section-block">
    <h2>ShÃ«ndeti i Sistemit</h2>
    
    <div *ngIf="isLoadingSystemHealth" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke kontrolluar shÃ«ndetin e sistemit...</p>
    </div>
    
    <div *ngIf="!isLoadingSystemHealth" class="system-health-grid">
      <div *ngFor="let key of getSystemHealthKeys()" class="health-item">
        <div class="health-label">{{ key }}</div>
        <div class="health-value" [class.healthy]="isSystemHealthy(key)">
          {{ getSystemHealthValue(key) }}
        </div>
      </div>
    </div>
  </section>

  <!-- Sezione Aplikimet e Supervisorit -->
  <section id="supervisor-applications-section" class="section-block">
    <h2>Aplikimet e Supervisorit</h2>
    
    <div *ngIf="isLoadingSupervisorApplications" class="loading-container">
      <div class="loading-spinner">â³</div>
      <p>Duke ngarkuar aplikimet e supervisorit...</p>
    </div>
    
    <div *ngIf="!isLoadingSupervisorApplications && supervisorApplications.length > 0" class="supervisor-applications-grid">
      <div *ngFor="let application of supervisorApplications" class="application-card">
        <div class="application-header">
          <h3>{{ application.schoolName }}</h3>
          <div class="application-status pending">NÃ« Pritje</div>
        </div>
        
        <div class="application-details">
          <div class="detail-row">
            <span class="label">Personi i Kontaktit:</span>
            <span class="value">{{ application.contactPersonFirstName }} {{ application.contactPersonLastName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Email:</span>
            <span class="value">{{ application.contactPersonEmail }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Telefoni:</span>
            <span class="value">{{ application.contactPersonPhone }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Qyteti:</span>
            <span class="value">{{ application.city }}</span>
          </div>
          <div class="detail-row" *ngIf="application.additionalInfo">
            <span class="label">Informacione ShtesÃ«:</span>
            <span class="value">{{ application.additionalInfo }}</span>
          </div>
        </div>
        
        <div class="application-actions">
          <button class="btn-approve" (click)="approveSupervisorApplication(application)">
            <i class="fas fa-check"></i>
            Pranoj
          </button>
          <button class="btn-reject" (click)="rejectSupervisorApplication(application)">
            <i class="fas fa-times"></i>
            Refuzoj
          </button>
        </div>
      </div>
    </div>
    
    <div *ngIf="!isLoadingSupervisorApplications && supervisorApplications.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>Nuk ka aplikime tÃ« reja</h3>
      <p>TÃ« gjitha aplikimet e supervisorit janÃ« tÃ« trajtuara ose nuk ka aplikime tÃ« reja.</p>
    </div>
  </section>


</div>
