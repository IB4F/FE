<div class="quiz-dashboard">
  <!-- Header with back button and progress -->
  <header class="quiz-header">
    <button class="back-button" (click)="goBack()">
      <span class="back-icon">←</span>
      Kthehu te Kurset
    </button>
    
    <div class="progress-info" *ngIf="progress">
      <div class="progress-stats">
        <div class="stat-item">
          <span class="stat-label">Kuizet e Përfunduara:</span>
          <span class="stat-value">{{ progress.completedQuizzes }}/{{ progress.totalQuizzes }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Pikët e Fituara:</span>
          <span class="stat-value">{{ progress.totalPointsEarned }}/{{ progress.totalPossiblePoints }}</span>
        </div>
      </div>
      
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
        </div>
        <span class="progress-text">{{ getProgressPercentage() | number:'1.0-0' }}%</span>
      </div>
      
      <div class="target-indicator" *ngIf="getTargetAchieved()">
        <span class="target-icon">🎯</span>
        Objektivi i Arritur! (70%+)
      </div>
    </div>
  </header>

  <!-- Quiz content -->
  <main class="quiz-main-content">
    <!-- Quiz type indicator -->
    <div class="quiz-type-indicator" *ngIf="currentQuiz">
      <span class="quiz-type-badge" [class.child-quiz]="isChildQuiz">
        {{ isChildQuiz ? 'Kuiz Ndihmes' : 'Kuiz' }}
      </span>
      <span class="quiz-points">{{ currentQuiz.points }} pikë</span>
    </div>

    <!-- Current quiz -->
    <ng-container *ngIf="currentQuiz && !showExplanation">
      <app-quiz
        [question]="currentQuiz.question"
        [options]="currentQuiz.options"
        [questionAudioUrl]="currentQuiz.questionAudioUrl"
        [multipleAnswer]="currentQuiz.multipleAnswer"
        (optionSelected)="handleOptionSelection($event)"
        (multipleOptionsSelected)="handleMultipleOptionsSelection($event)"
      ></app-quiz>
    </ng-container>

    <!-- Explanation screen -->
    <div class="explanation-container" *ngIf="showExplanation">
      <div class="explanation-box">
        <div class="explanation-header">
          <span class="explanation-icon">💡</span>
          <h3>Shpjegimi</h3>
        </div>
        
        <div class="explanation-content">
          <p>{{ explanation }}</p>
          
          <div class="explanation-audio" *ngIf="explanationAudioUrl">
            <button 
              class="explanation-audio-button" 
              (click)="toggleExplanationAudio()"
              [class.playing]="isExplanationAudioPlaying"
              type="button"
            >
              <span class="audio-icon" [class.playing]="isExplanationAudioPlaying">
                {{ isExplanationAudioPlaying ? '⏸️' : '🔊' }}
              </span>
              <span class="audio-text">
                {{ isExplanationAudioPlaying ? 'Ndalo Audio' : 'Luaj Audio' }}
              </span>
            </button>
          </div>
        </div>
        
        <div class="explanation-actions">
          <button 
            class="understood-button" 
            (click)="onExplanationUnderstood()"
            [class.has-child-quiz]="hasChildQuizzes"
          >
            {{ hasChildQuizzes ? 'E Kuptova - Vazhdo me Kuizin Ndihmes' : 'E Kuptova - Vazhdo' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Completion message -->
    <div class="completion-message" *ngIf="dataLoaded && !currentQuiz && progress && progress.completedQuizzes === progress.totalQuizzes">
      <div class="completion-box">
        <div class="completion-icon">🎉</div>
        <h2>Urime!</h2>
        <p>Ke përfunduar të gjitha kuizet me sukses!</p>
        
        <div class="final-stats" *ngIf="progress">
          <div class="final-stat">
            <span class="stat-number">{{ progress.totalPointsEarned }}</span>
            <span class="stat-label">Pikë të Fituara</span>
          </div>
          <div class="final-stat">
            <span class="stat-number">{{ progress.completedQuizzes }}</span>
            <span class="stat-label">Kuizet e Përfunduara</span>
          </div>
          <div class="final-stat">
            <span class="stat-number">{{ getProgressPercentage() | number:'1.0-0' }}%</span>
            <span class="stat-label">Sukses</span>
          </div>
        </div>
        
        <button class="back-to-courses" (click)="goBack()">
          Kthehu te Kurset
        </button>
      </div>
    </div>
  </main>
</div>
